syntax = "proto3";

option go_package = "internal/api/v1";

package watchclub;

import "google/protobuf/timestamp.proto";

// ScheduleIntervalUnit defines the time unit for club scheduling
enum ScheduleIntervalUnit {
  SCHEDULE_INTERVAL_UNIT_UNSPECIFIED = 0;
  SCHEDULE_INTERVAL_UNIT_DAYS = 1;
  SCHEDULE_INTERVAL_UNIT_WEEKS = 2;
  SCHEDULE_INTERVAL_UNIT_MONTHS = 3;
}

// Club represents a watch club where members coordinate watching things together
message Club {
  string id = 1;
  string name = 2;
  repeated string member_ids = 3;
  google.protobuf.Timestamp start_date = 4;
  bool started = 5; // Whether the club has been shuffled and started
  google.protobuf.Timestamp created_at = 6;
  int32 max_picks_per_member = 7; // Maximum picks each member can add (0 means unlimited)
  int32 schedule_interval_quantity = 8; // e.g., 1, 2, 3
  ScheduleIntervalUnit schedule_interval_unit = 9; // e.g., DAYS, WEEKS, MONTHS
}

// User represents a member of the watchclub
message User {
  string id = 1;
  string name = 2;
  string email = 3;
  google.protobuf.Timestamp created_at = 4;
}

// Pick represents something that a user has picked for their club to watch
message Pick {
  string id = 1;
  string club_id = 2;
  string user_id = 3;
  string title = 4;
  int32 year = 5;
  string notes = 6; // Optional notes about why they picked this
  google.protobuf.Timestamp created_at = 7;
  string link = 8; // Optional link to watch (streaming service, store, etc.)
}

// ScheduledPick represents which pick should be watched in a given period
message ScheduledPick {
  string id = 1;
  string club_id = 2;
  int32 sequence_number = 3; // 1, 2, 3, etc. - position in schedule
  google.protobuf.Timestamp start_date = 4; // When this pick's period starts
  Pick pick = 5;
}

// CreateUserRequest is the request to create a new user
message CreateUserRequest {
  string name = 1;
  string email = 2;
}

// CreateUserResponse is the response after creating a user
message CreateUserResponse {
  User user = 1;
}

// CreateClubRequest is the request to create a new club
message CreateClubRequest {
  string name = 1;
  google.protobuf.Timestamp start_date = 2;
  int32 max_picks_per_member = 3; // Maximum picks per member (defaults to 1 if not specified)
  int32 schedule_interval_quantity = 4; // Defaults to 1 if not specified
  ScheduleIntervalUnit schedule_interval_unit = 5; // Defaults to WEEKS if not specified
}

// CreateClubResponse is the response after creating a club
message CreateClubResponse {
  Club club = 1;
}

// JoinClubRequest is the request for a user to join a club
message JoinClubRequest {
  string club_id = 1;
  string user_id = 2;
}

// JoinClubResponse is the response after joining a club
message JoinClubResponse {
  Club club = 1;
}

// AddPickRequest is the request to add a pick to a club
message AddPickRequest {
  string club_id = 1;
  string user_id = 2;
  string title = 3;
  int32 year = 4;
  string notes = 5;
  string link = 6;
}

// AddPickResponse is the response after adding a pick
message AddPickResponse {
  Pick pick = 1;
}

// DeletePickRequest is the request to delete a pick
message DeletePickRequest {
  string pick_id = 1;
  string user_id = 2; // For authorization - only pick owner can delete
}

// DeletePickResponse is the response after deleting a pick
message DeletePickResponse {
  bool success = 1;
}

// GetClubRequest is the request to get club details
message GetClubRequest {
  string club_id = 1;
}

// GetClubResponse is the response with club details
message GetClubResponse {
  Club club = 1;
  repeated User members = 2;
  repeated Pick picks = 3;
}

// StartClubRequest is the request to shuffle picks and start the club
message StartClubRequest {
  string club_id = 1;
}

// StartClubResponse is the response after starting the club
message StartClubResponse {
  Club club = 1;
  repeated ScheduledPick assignments = 2;
}

// GetScheduledPicksRequest is the request to get the schedule
message GetScheduledPicksRequest {
  string club_id = 1;
}

// GetScheduledPicksResponse is the response with the schedule
message GetScheduledPicksResponse {
  repeated ScheduledPick assignments = 1;
}

// SendLoginEmailRequest is the request to send an account login email
message SendLoginEmailRequest {
  string email = 1;
}

// SendLoginEmailResponse is the response after sending a login email
message SendLoginEmailResponse {
  bool success = 1;
  string message = 2;
}

// GetUserRequest is the request to get a user by ID
message GetUserRequest {
  string user_id = 1;
}

// GetUserResponse is the response with user data
message GetUserResponse {
  User user = 1;
}

// GetClubCalendarRequest is the request to get a club's calendar
message GetClubCalendarRequest {
  string club_id = 1;
}

// GetClubCalendarResponse is the response with the ICS calendar data
message GetClubCalendarResponse {
  string ics_data = 1;
}

// WatchClubService is the main service for the watchclub application
service WatchClubService {
  // CreateUser creates a new user
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);

  // GetUser gets a user by ID
  rpc GetUser(GetUserRequest) returns (GetUserResponse);

  // CreateClub creates a new watch club
  rpc CreateClub(CreateClubRequest) returns (CreateClubResponse);

  // JoinClub adds a user to a club
  rpc JoinClub(JoinClubRequest) returns (JoinClubResponse);

  // AddPick adds a pick to a club
  rpc AddPick(AddPickRequest) returns (AddPickResponse);

  // DeletePick removes a pick from a club (only allowed before club starts)
  rpc DeletePick(DeletePickRequest) returns (DeletePickResponse);

  // GetClub gets details about a club including members and their picks
  rpc GetClub(GetClubRequest) returns (GetClubResponse);

  // StartClub shuffles all picks and generates the weekly viewing schedule
  rpc StartClub(StartClubRequest) returns (StartClubResponse);

  // GetScheduledPicks gets the schedule for a club
  rpc GetScheduledPicks(GetScheduledPicksRequest) returns (GetScheduledPicksResponse);

  // SendLoginEmail sends an account login email
  rpc SendLoginEmail(SendLoginEmailRequest) returns (SendLoginEmailResponse);

  // GetClubCalendar generates an ICS calendar file for a club's schedule
  rpc GetClubCalendar(GetClubCalendarRequest) returns (GetClubCalendarResponse);
}
